<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¹ãƒãƒ¼ãƒˆä¼šè­°ãƒ¡ãƒ¢ï¼ˆå®Œå…¨ç‰ˆï¼‰</title>
<style>
:root {
  --primary: #2563eb;
  --success: #22c55e;
  --danger: #ef4444;
  --bg-morning: linear-gradient(135deg, #f0f9ff, #e0f2fe);
  --bg-evening: linear-gradient(135deg, #faf5ff, #f3e8ff);
}
body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 20px; line-height: 1.6; color: #334155; transition: background 0.5s ease; min-height: 100vh; }
body.morning { background: var(--bg-morning); }
body.evening { background: var(--bg-evening); }
.container { max-width: 600px; margin: 0 auto; }
h1 { font-size: 1.5rem; text-align: center; margin-bottom: 24px; }
.card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 16px; }
.flex-group { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
input, select, textarea { padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; outline: none; }
input:focus, textarea:focus { border-color: var(--primary); }
input[type="text"] { flex: 1; }
button { padding: 10px 16px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: opacity 0.2s; font-size: 14px; }
button:active { opacity: 0.7; }
.btn-add { background: var(--success); color: white; }
.btn-primary { background: var(--primary); color: white; width: 100%; margin-top: 10px; font-size: 16px; }
.btn-copy { background: #0ea5e9; color: white; margin-top: 8px; }
.btn-download { background: #2563eb; color: white; margin-top: 8px; }
.person { background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; border-left: 5px solid #cbd5e1; }
.person.active { border-left-color: var(--primary); background: #f8faff; }
.person h2 { font-size: 1rem; margin: 0 0 10px 0; display: flex; align-items: center; }
.remove { position: absolute; top: 12px; right: 12px; background: none; color: #94a3b8; font-size: 20px; padding: 0; }
.remove:hover { color: var(--danger); }
textarea { width: 100%; min-height: 80px; resize: vertical; box-sizing: border-box; }
.speech-area { text-align: center; background: #1e293b; color: white; padding: 15px; border-radius: 12px; margin-bottom: 16px; }
.speech-area select { background: #334155; color: white; border: none; }
.output-area { margin-top: 24px; }
#output, #chatGptPrompt { width: 100%; font-family: monospace; }
#output { height: 150px; background: #f1f5f9; }
#chatGptPrompt { min-height:120px; background:#f8fafc; }
.status-msg { font-size: 12px; color: var(--success); margin-left: 8px; }
</style>
</head>
<body class="morning">
<div class="container">
  <h1>ğŸŒ¤ ä¼šè­°ãƒ¡ãƒ¢ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼ˆå®Œå…¨ç‰ˆï¼‰</h1>

  <div class="card">
    <div class="flex-group">
      <input type="date" id="meetingDate">
      <select id="meetingType" onchange="switchTheme()">
        <option value="AM_æœç¤¼">â˜€ï¸ æœç¤¼</option>
        <option value="PM_çµ‚ç¤¼">ğŸŒ™ çµ‚ç¤¼</option>
        <option value="MTG_è‡¨æ™‚">ğŸ’¡ è‡¨æ™‚MTG</option>
      </select>
    </div>
    <div class="flex-group">
      <input id="newName" placeholder="æ–°ã—ã„ãƒ¡ãƒ³ãƒãƒ¼å" onkeypress="if(event.key==='Enter') addPerson()">
      <button class="btn-add" onclick="addPerson()">è¿½åŠ </button>
    </div>
  </div>

  <div class="speech-area">
    <div style="margin-bottom:8px">ğŸ¤ éŸ³å£°å…¥åŠ›</div>
    <select id="activeSpeaker" onchange="highlightSpeaker()"></select>
    <button id="startBtn" onclick="toggleRecognition(true)" style="background:var(--success); color:white; margin-left:10px">é–‹å§‹</button>
    <button id="stopBtn" onclick="toggleRecognition(false)" style="display:none; background:var(--danger); color:white; margin-left:10px">åœæ­¢</button>
    <div id="micStatus" style="font-size:11px; margin-top:5px; color:#94a3b8;">ãƒã‚¤ã‚¯å¾…æ©Ÿä¸­...</div>
  </div>

  <div id="people"></div>

  <button class="btn-primary" onclick="buildMemo()">ğŸ“‹ å›ºå®šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ç”Ÿæˆ</button>

  <div class="output-area">
    <h3>ğŸ“ å›ºå®šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ†ã‚­ã‚¹ãƒˆ</h3>
    <textarea id="output" readonly placeholder="ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
    <button class="btn-copy" onclick="copyAll()">å…¨æ–‡ã‚³ãƒ”ãƒ¼</button>
    <button class="btn-download" onclick="downloadTxt()">â¬‡ .txtã§ä¿å­˜</button>
    <span id="copyMsg" class="status-msg"></span>

    <h3 style="margin-top:12px;">ğŸ’¡ ChatGPTç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h3>
    <textarea id="chatGptPrompt" readonly placeholder="ChatGPTã«è²¼ã‚‹ç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
    <button class="btn-copy" onclick="copyPrompt()">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚³ãƒ”ãƒ¼</button>
    <span id="promptMsg" class="status-msg"></span>
  </div>
</div>

<script>
let recognition;
let isRecognizing = false;
const defaultPeople = ['ã‚¨ãƒªãƒ¼ã•ã‚“','ãƒ¦ã‚¦ãƒ¤','ã‚ã‚ã®ã•ã‚“','ã‚«ãƒ„ã•ã‚“'];

window.onload = () => {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('meetingDate').value = today;
  const saved = localStorage.getItem('meeting_members');
  const members = saved ? JSON.parse(saved) : defaultPeople;
  members.forEach(m => addPerson(m));
  switchTheme();
};

function switchTheme(){
  const type = document.getElementById('meetingType').value;
  document.body.className = (type === 'AM_æœç¤¼') ? 'morning' : 'evening';
}

function addPerson(name){
  const personName = typeof name === 'string' ? name : document.getElementById('newName').value.trim();
  if(!personName) return;
  const div = document.createElement('div');
  div.className = 'person';
  div.dataset.name = personName;
  div.innerHTML = `<button class="remove" onclick="removePerson(this)">Ã—</button>
                   <h2>ğŸ‘¤ ${personName}</h2>
                   <textarea placeholder="${personName}ã®ç™ºè¨€ã‚’ãƒ¡ãƒ¢..."></textarea>`;
  document.getElementById('people').appendChild(div);
  document.getElementById('newName').value = '';
  updateActiveSpeakerOptions();
  saveMembers();
}

function removePerson(btn) {
  btn.parentElement.remove();
  updateActiveSpeakerOptions();
  saveMembers();
}

function updateActiveSpeakerOptions(){
  const select = document.getElementById('activeSpeaker');
  const current = select.value;
  select.innerHTML = '';
  document.querySelectorAll('.person h2').forEach(h2 => {
    const name = h2.innerText.replace('ğŸ‘¤ ', '');
    const opt = new Option(name, name);
    if(name === current) opt.selected = true;
    select.add(opt);
  });
  highlightSpeaker();
}

function highlightSpeaker() {
  const activeName = document.getElementById('activeSpeaker').value;
  document.querySelectorAll('.person').forEach(p => {
    p.classList.toggle('active', p.dataset.name === activeName);
  });
}

function toggleRecognition(start) {
  if (start) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) return alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
    recognition = new SpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.onstart = () => {
      isRecognizing = true;
      document.getElementById('startBtn').style.display = 'none';
      document.getElementById('stopBtn').style.display = 'inline-block';
      document.getElementById('micStatus').innerText = 'âš¡ èªè­˜ä¸­... ãŠè©±ã—ãã ã•ã„';
      document.getElementById('micStatus').style.color = '#4ade80';
    };
    recognition.onresult = (event) => {
      const text = event.results[event.results.length - 1][0].transcript;
      appendToSpeaker(text);
    };
    recognition.onend = () => {
      if (isRecognizing) recognition.start();
    };
    recognition.start();
  } else {
    isRecognizing = false;
    if (recognition) recognition.stop();
    document.getElementById('startBtn').style.display = 'inline-block';
    document.getElementById('stopBtn').style.display = 'none';
    document.getElementById('micStatus').innerText = 'ãƒã‚¤ã‚¯å¾…æ©Ÿä¸­...';
    document.getElementById('micStatus').style.color = '#94a3b8';
  }
}

function appendToSpeaker(text) {
  const activeName = document.getElementById('activeSpeaker').value;
  const targetCard = Array.from(document.querySelectorAll('.person')).find(p => p.dataset.name === activeName);
  if (targetCard) {
    const ta = targetCard.querySelector('textarea');
    ta.value += (ta.value ? '\n' : '') + text;
    ta.scrollTop = ta.scrollHeight;
  }
}

function escapeHTML(str){
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
            .replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function buildMemo() {
  const date = document.getElementById('meetingDate').value.replace(/-/g, '/');
  const type = document.getElementById('meetingType').value;

  let result = `${date}\n\n${type}\n\n`;
  document.querySelectorAll('.person').forEach(p => {
    const name = escapeHTML(p.dataset.name);
    const text = p.querySelector('textarea').value.trim();
    if(!text) return;
    result += `ç™ºè¨€è€…ï¼š${name}\n`;
    text.split('\n').forEach(line => {
      if(line) result += `ãƒ»${escapeHTML(line.replace(/^ãƒ»/,''))}\n`;
    });
    result += '\n';
  });
  document.getElementById('output').value = result.trim();

  // ChatGPTç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
  let prompt = `ä»¥ä¸‹ã®ãƒ¡ãƒ¢ã‹ã‚‰ã€ãƒãƒ¼ãƒ å…±æœ‰ç”¨ã®è­°äº‹éŒ²ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n`;
  prompt += `å½¢å¼ï¼šæ—¥ä»˜ã€åå‰ã€ç®‡æ¡æ›¸ãï¼ˆè¦ç‚¹ã‚’æ•´ç†ï¼‰\n\n`;
  prompt += `ã€${date} ${type}ã€‘\n`;
  prompt += result;
  prompt += `\n\nâ€»ã“ã®ã¾ã¾ã‚³ãƒ”ãƒ¼ã—ã¦ChatGPTã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚`;
  document.getElementById('chatGptPrompt').value = prompt;
}

function copyAll() {
  const out = document.getElementById('output');
  out.select();
  navigator.clipboard.writeText(out.value).then(() => {
    const msg = document.getElementById('copyMsg');
    msg.innerText = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†ï¼';
    setTimeout(() => msg.innerText = '', 2000);
  });
}

function copyPrompt() {
  const ta = document.getElementById('chatGptPrompt');
  ta.select();
  navigator.clipboard.writeText(ta.value).then(() => {
    const msg = document.getElementById('promptMsg');
    msg.innerText = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†ï¼';
    setTimeout(() => msg.innerText = '', 2000);
  });
}

function downloadTxt() {
  const text = document.getElementById('output').value;
  if (!text.trim()) return alert('ãƒ†ã‚­ã‚¹ãƒˆãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');

  const blob = new Blob([text], {type:'text/plain;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = getFileName();
  a.click();
  URL.revokeObjectURL(a.href);
}

function getFileName() {
  const date = document.getElementById('meetingDate').value.replace(/-/g,'');
  const type = document.getElementById('meetingType').value.split('_')[1] || 'meeting';
  return `${date}_${type}.txt`;
}

function saveMembers() {
  const members = Array.from(document.querySelectorAll('.person')).map(p => p.dataset.name);
  localStorage.setItem('meeting_members', JSON.stringify(members));
}
</script>
</body>
</html>
